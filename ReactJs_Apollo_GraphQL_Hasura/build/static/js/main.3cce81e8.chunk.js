(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{51:function(e,t,n){e.exports=n.p+"static/media/loading.c5590569.svg"},61:function(e,t,n){e.exports=n(95)},66:function(e,t,n){},95:function(e,t,n){"use strict";n.r(t);var a=n(33),r=n.n(a),o=n(0),c=n.n(o),l=n(100),i=(n(66),n(18)),u=n.n(i),s=n(25),d=n(5),m=n(49),p=n(50),f=n.n(p),b=n(51),v=n.n(b),g=function(){return c.a.createElement("div",{style:{position:"absolute",display:"flex",justifyContent:"center",height:"100vh",width:"100vw",top:0,bottom:0,left:0,right:0,backgroundColor:"white"}},c.a.createElement("img",{src:v.a,alt:"loading"}))},E=n(101),h=function(){var e=ie(),t=e.loading,n=e.loginWithRedirect;return t?c.a.createElement("div",null,"Loading..."):c.a.createElement("div",{className:"overlay"},c.a.createElement("div",{className:"overlay-content"},c.a.createElement("div",{className:"overlay-heading"},"Welcome to the GraphQL tutorial app"),c.a.createElement("div",{className:"overlay-message"},"Please login to continue"),c.a.createElement("div",{className:"overlay-action"},c.a.createElement(E.a,{id:"qsLoginBtn",variant:"primary",className:"btn-margin loginBtn",onClick:function(){n({})}},"Log In"))))},O=n(99),j=function(e){var t=e.logoutHandler;return c.a.createElement(E.a,{id:"qsLogoutBtn",variant:"primary",className:"btn-margin logoutBtn",onClick:t},"Log Out")},y=function(e){var t=e.logoutHandler;return c.a.createElement(O.a,{className:"justify-content-between"},c.a.createElement(O.a.Brand,null,"GraphQL Tutorial App"),c.a.createElement(O.a.Collapse,{className:"justify-content-end"},c.a.createElement(j,{logoutHandler:t})))},w=n(27),_=n(11),k=n(12),N=n.n(k),C=n(10),T=n(19);function x(){var e=Object(_.a)(["\n        mutation toggleTodo($id: Int!, $isCompleted: Boolean!) {\n            update_todos(\n                where: { id: { _eq: $id } }\n                _set: { is_completed: $isCompleted }\n            ) {\n                affected_rows\n            }\n        }\n    "]);return x=function(){return e},e}function q(){var e=Object(_.a)(["\n        mutation removeTodo($id: Int!) {\n            delete_todos(where: { id: { _eq: $id } }) {\n                affected_rows\n            }\n        }\n    "]);return q=function(){return e},e}var I=function(e){e.index;var t=e.todo,n=N()(q()),a=Object(C.b)(n),r=Object(d.a)(a,1)[0],o=N()(x()),l=Object(C.b)(o),i=Object(d.a)(l,1)[0];return c.a.createElement("li",null,c.a.createElement("div",{className:"view"},c.a.createElement("div",{className:"round"},c.a.createElement("input",{checked:t.is_completed,type:"checkbox",id:t.id,onChange:function(){i({variables:{id:t.id,isCompleted:!t.is_completed},optimisticResponse:null,update:function(e){var n=e.readQuery({query:R}).todos.map(function(e){return e.id===t.id?Object(T.a)({},e,{is_completed:!e.is_completed}):e});e.writeQuery({query:R,data:{todos:n}})}})}}),c.a.createElement("label",{htmlFor:t.id}))),c.a.createElement("div",{className:"labelContent"+(t.is_completed?" completed":"")},c.a.createElement("div",null,t.title)),c.a.createElement("button",{className:"closeBtn",onClick:function(e){e.preventDefault(),e.stopPropagation(),r({variables:{id:t.id},optimisticResponse:null,update:function(e){var n=e.readQuery({query:R}).todos.filter(function(e){return e.id!==t.id});e.writeQuery({query:R,data:{todos:n}})}})}},"x"))},P=function(e){var t=e.todos,n=e.currentFilter,a=e.filterResultsFn,r=e.clearCompletedFn,o=function(e){return function(){a(e)}},l=c.a.createElement("button",{onClick:r,className:"clearComp"},"Clear completed"),i=t.filter(function(e){return!0!==e.is_completed}),u=t.length;return"active"===n?u=i.length:"completed"===n&&(u=t.length-i.length),c.a.createElement("div",{className:"footerList"},c.a.createElement("span",null," ",u," item",1!==u?"s":""),c.a.createElement("ul",null,c.a.createElement("li",{onClick:o("all")},c.a.createElement("a",{className:"all"===n?"selected":""},"All")),c.a.createElement("li",{onClick:o("active")},c.a.createElement("a",{className:"active"===n?"selected":""},"Active")),c.a.createElement("li",{onClick:o("completed")},c.a.createElement("a",{className:"completed"===n?"selected":""},"Completed"))),l)};function S(){var e=Object(_.a)(["\n    mutation clearCompleted {\n        delete_todos(\n            where: { is_completed: { _eq: true }, is_public: { _eq: false } }\n        ) {\n            affected_rows\n        }\n    }\n"]);return S=function(){return e},e}function W(){var e=Object(_.a)(["\n    query getMyTodos {\n        todos(\n            where: { is_public: { _eq: false } }\n            order_by: { created_at: desc }\n        ) {\n            id\n            title\n            created_at\n            is_completed\n        }\n    }\n"]);return W=function(){return e},e}var R=N()(W()),L=N()(S()),$=function(e){var t=Object(o.useState)({filter:"all",clearInProgress:!1}),n=Object(d.a)(t,2),a=n[0],r=n[1],l=Object(C.b)(L),i=Object(d.a)(l,1)[0],u=e.todos,s=u;"active"===a.filter?s=u.filter(function(e){return!0!==e.is_completed}):"completed"===a.filter&&(s=u.filter(function(e){return!0===e.is_completed}));var m=[];return s.forEach(function(e,t){m.push(c.a.createElement(I,{key:t,index:t,todo:e}))}),c.a.createElement(o.Fragment,null,c.a.createElement("div",{className:"todoListWrapper"},c.a.createElement("ul",null,m)),c.a.createElement(P,{todos:s,currentFilter:a.filter,filterResultsFn:function(e){r(Object(T.a)({},a,{filter:e}))},clearCompletedFn:function(){i({optimisticResponse:null,update:function(e,t){t.data;var n=e.readQuery({query:R}).todos.filter(function(e){return!e.is_completed});e.writeQuery({query:R,data:{todos:n}})}})},clearInProgress:a.clearInProgress}))},F=function(){var e=Object(C.c)(R),t=e.loading,n=e.error,a=e.data;return t?c.a.createElement("div",null,"Loading..."):n?(console.error(n),c.a.createElement("div",null,"Error!")):c.a.createElement($,{todos:a.todos})};function A(){var e=Object(_.a)(["\n    mutation($todo: String!, $isPublic: Boolean!) {\n        insert_todos(objects: { title: $todo, is_public: $isPublic }) {\n            affected_rows\n            returning {\n                id\n                title\n                created_at\n                is_completed\n            }\n        }\n    }\n"]);return A=function(){return e},e}var Q=N()(A()),B=function(e){var t=e.isPublic,n=void 0!==t&&t,a=Object(o.useState)(""),r=Object(d.a)(a,2),l=r[0],i=r[1],u=Object(C.b)(Q,{update:function(e,t){var a=t.data;if(n)return null;var r=e.readQuery({query:R}),o=a.insert_todos.returning[0];e.writeQuery({query:R,data:{todos:[o].concat(Object(w.a)(r.todos))}})},onCompleted:function(){i("")}}),s=Object(d.a)(u,1)[0];return c.a.createElement("form",{className:"formInput",onSubmit:function(e){e.preventDefault(),s({variables:{todo:l,isPublic:n}})}},c.a.createElement("input",{className:"input",placeholder:"What needs to be done?",value:l,onChange:function(e){return i(e.target.value)},ref:function(e){return e},required:!0}),c.a.createElement("i",{className:"inputMarker fa fa-angle-right"}))},H=function(){return c.a.createElement("div",{className:"todoWrapper"},c.a.createElement("div",{className:"sectionHeader"},"Personal todos"),c.a.createElement(B,null),c.a.createElement(F,null))},M=function(e){e.index;var t=e.todo;return c.a.createElement("li",null,c.a.createElement("div",{className:"userInfoPublic",title:t.user.name},"@",t.user.name),c.a.createElement("div",{className:"labelContent"+(t.is_completed?" completed":"")},c.a.createElement("div",null,t.title)))};function U(){var e=Object(_.a)(["\n    subscription notifyNewPublicTodos {\n        todos(\n            where: { is_public: { _eq: true } }\n            limit: 1\n            order_by: { created_at: desc }\n        ) {\n            id\n            created_at\n        }\n    }\n"]);return U=function(){return e},e}function z(){var e=Object(_.a)(["\n            query getNewPublicTodos($latestVisibleId: Int) {\n                todos(\n                    where: {\n                        is_public: { _eq: true }\n                        id: { _gt: $latestVisibleId }\n                    }\n                    order_by: { created_at: desc }\n                ) {\n                    id\n                    title\n                    created_at\n                    user {\n                        name\n                    }\n                }\n            }\n        "]);return z=function(){return e},e}function V(){var e=Object(_.a)(["\n            query getOldPublicTodos($oldestTodoId: Int!) {\n                todos(\n                    where: {\n                        is_public: { _eq: true }\n                        id: { _lt: $oldestTodoId }\n                    }\n                    limit: 7\n                    order_by: { created_at: desc }\n                ) {\n                    id\n                    title\n                    created_at\n                    user {\n                        name\n                    }\n                }\n            }\n        "]);return V=function(){return e},e}var D=function(e){var t=Object(o.useState)({olderTodosAvailable:!!e.latestTodo,newTodosCount:0,error:!1,todos:[]}),n=Object(d.a)(t,2),a=n[0],r=n[1],l=a.todos.length,i=l?a.todos[l-1].id:e.latestTodo?e.latestTodo.id+1:0,m=l?a.todos[0].id:e.latestTodo?e.latestTodo.id:0,p=Object(C.a)();Object(o.useEffect)(function(){f()},[]),Object(o.useEffect)(function(){e.latestTodo&&e.latestTodo.id>m&&(r(function(e){return Object(T.a)({},e,{newTodosCount:e.newTodosCount+1})}),m=e.latestTodo.id)},[e.latestTodo]);var f=function(){var e=Object(s.a)(u.a.mark(function e(){var t,n,a,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=N()(V()),e.next=3,p.query({query:t,variables:{oldestTodoId:i}});case 3:n=e.sent,a=n.error,(o=n.data).todos.length?(r(function(e){return Object(T.a)({},e,{todos:[].concat(Object(w.a)(e.todos),Object(w.a)(o.todos))})}),i=o.todos[o.todos.length-1].id):r(function(e){return Object(T.a)({},e,{olderTodosAvailable:!1})}),a&&(console.error(a),r(function(e){return Object(T.a)({},e,{error:!0})}));case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=Object(s.a)(u.a.mark(function e(){var t,n,o,c;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=N()(z()),e.next=3,p.query({query:t,variables:{latestVisibleId:a.todos.length?a.todos[0].id:null}});case 3:n=e.sent,o=n.error,(c=n.data)&&(r(function(e){return Object(T.a)({},e,{todos:[].concat(Object(w.a)(c.todos),Object(w.a)(e.todos)),newTodosCount:0})}),m=c.todos[0].id),o&&(console.error(o),r(function(e){return Object(T.a)({},e,{error:!0})}));case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return c.a.createElement(o.Fragment,null,c.a.createElement("div",{className:"todoListWrapper"},0!==a.newTodosCount&&c.a.createElement("div",{className:"loadMoreSection",onClick:b},"New tasks have arrived! (",a.newTodosCount.toString(),")"),c.a.createElement("ul",null,a.todos&&a.todos.map(function(e,t){return c.a.createElement(M,{key:t,index:t,todo:e})})),c.a.createElement("div",{className:"loadMoreSection",onClick:f},a.olderTodosAvailable?"Load older tasks":"No more public tasks!")))},G=N()(U()),J=function(){var e=Object(C.d)(G),t=e.loading,n=e.error,a=e.data;return t?c.a.createElement("span",null,"Loading..."):n?c.a.createElement("span",null,"Error"):c.a.createElement(D,{latestTodo:a.todos.length?a.todos[0]:null})},K=function(){return c.a.createElement("div",{className:"todoWrapper"},c.a.createElement("div",{className:"sectionHeader"},"Public feed (realtime)"),c.a.createElement(B,{isPublic:!0}),c.a.createElement(J,null))},X=function(e){var t=e.user;return c.a.createElement("div",{className:"userInfo"},c.a.createElement("div",{className:"userImg"},c.a.createElement("i",{className:"far fa-user"})),c.a.createElement("div",{className:"userName"},t.name))};function Y(){var e=Object(_.a)(["\n            subscription getOnlineUsers {\n                online_users(order_by: { user: { name: asc } }) {\n                    id\n                    user {\n                        name\n                    }\n                }\n            }\n        "]);return Y=function(){return e},e}function Z(){var e=Object(_.a)(["\n        mutation updateLastSeen($now: timestamptz!) {\n            update_users(where: {}, _set: { last_seen: $now }) {\n                affected_rows\n            }\n        }\n    "]);return Z=function(){return e},e}var ee=function(){var e,t=Object(o.useState)(0),n=Object(d.a)(t,2),a=n[0],r=n[1];Object(o.useEffect)(function(){return s(),r(setInterval(function(){return s()},3e4)),function(){clearInterval(a)}},[]);var l=N()(Z()),i=Object(C.b)(l),u=Object(d.a)(i,1)[0],s=function(){u({variables:{now:(new Date).toISOString()}})},m=Object(C.d)(N()(Y())),p=m.loading,f=m.error,b=m.data;return p?c.a.createElement("span",null,"Loading..."):f?(console.error(f),c.a.createElement("span",null,"Error!")):(b&&(e=b.online_users.map(function(e){return c.a.createElement(X,{key:e.id,user:e.user})})),c.a.createElement("div",{className:"onlineUsersWrapper"},c.a.createElement(o.Fragment,null,c.a.createElement("div",{className:"sliderHeader"},"Online users - ",e.length),e)))},te=n(24),ne=n(60),ae=n(57),re=n(7),oe=function(e){var t=e.idToken,n=ie(),a=n.loading,r=n.logout;if(a)return c.a.createElement("div",null,"Loading...");var o,l=(o=t,new te.c({link:new ae.a({uri:"wss://hasura.io/learn/graphql",options:{reconnect:!0,connectionParams:{headers:{Authorization:"Bearer ".concat(o)}}}}),cache:new ne.a}));return c.a.createElement(re.a,{client:l},c.a.createElement(y,{logoutHandler:r}),c.a.createElement("div",{className:"row container-fluid p-left-right-0 m-left-right-0"},c.a.createElement("div",{className:"row col-md-9 p-left-right-0 m-left-right-0"},c.a.createElement("div",{className:"col-md-6 sliderMenu p-30"},c.a.createElement(H,null)),c.a.createElement("div",{className:"col-md-6 sliderMenu p-30 bg-gray border-right"},c.a.createElement(K,null))),c.a.createElement("div",{className:"col-md-3 p-left-right-0"},c.a.createElement("div",{className:"col-md-12 sliderMenu p-30 bg-gray"},c.a.createElement(ee,null)))))},ce=function(){return window.history.replaceState({},document.title,window.location.pathname)},le=c.a.createContext(),ie=function(){return Object(o.useContext)(le)},ue=function(e){var t=e.children,n=e.onRedirectCallback,a=void 0===n?ce:n,r=Object(m.a)(e,["children","onRedirectCallback"]),l=Object(o.useState)(!1),i=Object(d.a)(l,2),p=i[0],b=i[1],v=Object(o.useState)(),E=Object(d.a)(v,2),O=E[0],j=E[1],y=Object(o.useState)(),w=Object(d.a)(y,2),_=w[0],k=w[1],N=Object(o.useState)(!0),C=Object(d.a)(N,2),T=C[0],x=C[1],q=Object(o.useState)(!1),I=Object(d.a)(q,2),P=I[0],S=I[1],W=Object(o.useState)(""),R=Object(d.a)(W,2),L=R[0],$=R[1];Object(o.useEffect)(function(){(function(){var e=Object(s.a)(u.a.mark(function e(){var t,n,o,c,l,i;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f()(r);case 2:if(t=e.sent,k(t),!window.location.search.includes("code=")){e.next=10;break}return e.next=7,t.handleRedirectCallback();case 7:n=e.sent,o=n.appState,a(o);case 10:return e.next=12,t.isAuthenticated();case 12:if(c=e.sent,b(c),!c){e.next=23;break}return e.next=17,t.getUser();case 17:return l=e.sent,j(l),e.next=21,t.getIdTokenClaims();case 21:i=e.sent,$(i.__raw);case 23:x(!1);case 24:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}})()()},[]);var F=function(){var e=Object(s.a)(u.a.mark(function e(){var t,n,a=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},S(!0),e.prev=2,e.next=5,_.loginWithPopup(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error(e.t0);case 10:return e.prev=10,S(!1),e.finish(10);case 13:return e.next=15,_.getUser();case 15:n=e.sent,j(n),b(!0);case 18:case"end":return e.stop()}},e,null,[[2,7,10,13]])}));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(s.a)(u.a.mark(function e(){var t,n,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x(!0),e.next=3,_.handleRedirectCallback();case 3:return t=e.sent,e.next=6,_.getUser();case 6:return n=e.sent,e.next=9,_.getIdTokenClaims();case 9:return a=e.sent,$(a.__raw),x(!1),b(!0),j(n),e.abrupt("return",t);case 15:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return T?c.a.createElement(g,null):p?c.a.createElement(le.Provider,{value:{isAuthenticated:p,user:O,loading:T,popupOpen:P,loginWithPopup:F,handleRedirectCallback:A,getIdTokenClaims:function(){return _.getIdTokenClaims.apply(_,arguments)},loginWithRedirect:function(){return _.loginWithRedirect.apply(_,arguments)},getTokenSilently:function(){return _.getTokenSilently.apply(_,arguments)},getTokenWithPopup:function(){return _.getTokenWithPopup.apply(_,arguments)},logout:function(){return _.logout.apply(_,arguments)}}},t,c.a.createElement(oe,{idToken:L})):c.a.createElement(le.Provider,{value:{isAuthenticated:p,user:O,loading:T,popupOpen:P,loginWithPopup:F,handleRedirectCallback:A,getIdTokenClaims:function(){return _.getIdTokenClaims.apply(_,arguments)},loginWithRedirect:function(){return _.loginWithRedirect.apply(_,arguments)},getTokenSilently:function(){return _.getTokenSilently.apply(_,arguments)},getTokenWithPopup:function(){return _.getTokenWithPopup.apply(_,arguments)},logout:function(){return _.logout.apply(_,arguments)}}},c.a.createElement(h,null))},se=n(22),de=Object(se.a)(),me="graphql-tutorials.auth0.com",pe="P38qnFo1lFAQJrzkun--wEzqljVNGcWW",fe="http://localhost:3000/callback",be=function(e){de.push(e&&e.targetUrl?e.targetUrl:window.location.pathname)},ve=c.a.createElement(l.b,{history:de},c.a.createElement(l.a,{path:"/",render:function(){return c.a.createElement(ue,{domain:me,client_id:pe,redirect_uri:fe,onRedirectCallback:be})}}));r.a.render(ve,document.getElementById("root"))}},[[61,1,2]]]);
//# sourceMappingURL=main.3cce81e8.chunk.js.map